/**
 * Supplies services and tools to be used as dependency injection
 * into the classes of this system.
 * There are many configuration choices involved. Its best to have
 * a function that creates a ValidationService with its configuration together.
 * Copy the /starter_code/create_services.ts file into your app.
 * It contains such a function, createValidationServices().
 * Edit that file to adjust your configuration.
 * @module Services/ConcreteClasses/ValidationServices
 */

import { CodingError } from '../Utilities/ErrorHandling';
import type { ILoggerService } from '../Interfaces/LoggerService';
import type { IValidatorFactory } from '../Interfaces/Validator';
import { ServiceName, type IValidationServices } from '../Interfaces/ValidationServices';
import { IValueHostFactory } from '../Interfaces/ValueHost';
import { ValidatorFactory } from '../Validation/Validator';
import { ValueHostFactory, registerStandardValueHostGenerators } from '../ValueHosts/ValueHostFactory';
import { ConsoleLoggerService } from './ConsoleLoggerService';
import { IAutoGenerateDataTypeCheckService } from '../Interfaces/AutoGenerateDataTypeCheckService';
import { IDataTypeFormatterService } from '../Interfaces/DataTypeFormatterService';
import { IMessageTokenResolverService } from '../Interfaces/MessageTokenResolverService';
import { IServiceWithFallback } from '../Interfaces/Services';
import { ValueHostsServices } from './ValueHostsServices';

/**
 * Supplies services and tools to be used as dependency injection
 * into the classes of this system. It also supplies factories.
 * There are many configuration choices involved. Its best to have
 * a function that creates a ValidationService with its configuration together.
 * Copy the /starter_code/create_services.ts file into your app.
 * It contains such a function, createValidationServices().
 * Edit that file to adjust your configuration.
 */
export class ValidationServices extends ValueHostsServices implements IValidationServices {

    /**
     * Service for formatting data types used within tokens of error messages
    *  using {@link DataTypes/Types/IDataTypeFormatter!IDataTypeFormatter | IDataTypeFormatter} instances.
     */
    public get dataTypeFormatterService(): IDataTypeFormatterService {
        let service = this.getService<IDataTypeFormatterService>(ServiceName.formatter);
        if (!service)
            throw new CodingError('Must assign ValidationServices.dataTypeFormatterService.');

        return service;
    }
    public set dataTypeFormatterService(service: IDataTypeFormatterService) {
        this.setService(ServiceName.formatter, service);
    }

    /**
     * Service that supports automatic generation of Conditions for the Data Type Check
     * using {@link DataTypes/Types/IDataTypeCheckGenerator!IDataTypeCheckGenerator | IDataTypeCheckGenerator} instances.
     */
    public get autoGenerateDataTypeCheckService(): IAutoGenerateDataTypeCheckService {
        let service = this.getService<IAutoGenerateDataTypeCheckService>(ServiceName.autoGenerator);
        if (!service)
            throw new CodingError('Must assign ValidationServices.autoGenerateDataTypeCheckService.');

        return service;
    }
    public set autoGenerateDataTypeCheckService(service: IAutoGenerateDataTypeCheckService) {
        this.setService(ServiceName.autoGenerator, service);
    }

    /**
     * Service to get the IMessageTokenResolver instance that replaces
     * tokens in messages.
     */
    public get messageTokenResolverService(): IMessageTokenResolverService {
        let service = this.getService<IMessageTokenResolverService>(ServiceName.messageTokenResolver);
        if (!service)
            throw new CodingError('Must assign ValidationServices.MessageTokenResolverService.');

        return service;
    }
    public set messageTokenResolverService(service: IMessageTokenResolverService) {
        this.setService(ServiceName.messageTokenResolver, service);
    }

    //#region ValidatorFactory    
    /**
     * The ValidatorFactory to use.
     * It supplies a default if not setup by the user.
     */
    public get validatorFactory(): IValidatorFactory {
        let service = this.getService<IValidatorFactory>(ServiceName.validatorFactory);
        if (!service) {
            service = new ValidatorFactory();
            this.setService(ServiceName.validatorFactory, service);
        }
        return service;
    }
    public set validatorFactory(factory: ValidatorFactory) {
        this.setService(ServiceName.validatorFactory, factory);
    }

    //#endregion ValidatorFactory        
}
